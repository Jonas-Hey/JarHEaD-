== SPARQL Endpoint ==

The {{PRODUCT}} offers access to its RDF data repository from a standard compliant SPARQL 1.1 endpoint. This endpoint can be accessed by sending HTTP requests to '''<nowiki>http://<SERVER>:<PORT>/sparql</nowiki>''' with the URL-encoded SPARQL query as a request parameter. For further information about the SPARQL protocol, please refer to the official W3C specification available at http://www.w3.org/TR/sparql11-protocol/. In addition, we provide a <a href="../sparql">web-based interface</a> as illustrated in the following.

<br/>

<img src="../images/help/sparqlInterface.png" width="924px" />

<br/>

The interface based on the <a href="http://openuplabs.tso.co.uk/demos/sparqleditor">Flint</a> library assists query editing in several ways:
* The query entered in the edit form gets automatically validated against the SPARQL 1.1 syntax. The message "Query is valid/invalid" is shown in the statusbar, while in the edit form invalid tokens are underlined.
* The tabs on the right-hand sidebar can be used to select and insert parts of the query instead of typing them:
** SPARQL terms: the choice of available terms depends on the cursor position in the edit form so that only relevant keywords can be inserted.
** Namespace prefixes: the list of namespaces is declared in the ''config/namespaces.prop'' and can be also edited in the system itself on the [[Admin:Namespaces]] page.
** Properties: properties existing in the data repository.
** Classes: types of entities stored in the data repository.

The SPARQL Editor supports suggestions of possibly relevant tokens and terms: pressing Ctrl+Space while typing opens a drop-down list containing possibly relevant tokens and SPARQL terms which can be used in the current position (e.g. properties or classes)

Example properties: If the namespace "rdf:" is entered, all known properties can be listed by pressing Ctrl+Space.

<img src="../images/help/editor-suggestion-properties.png" />

Example classes: If the namespace "owl:" is entered, all known classes can be listed by pressing Ctrl+Space.

<img src="../images/help/editor-suggestion-classes.png" />


=== Security Aspects ===

The SPARQL endpoint is security protected to avoid unauthorized access from the outside. In the following, we summarize the configuration options and the default configuration.
The Information Workbench and eCloudManager allow specifying a finer granularity of configuration using [[Help:UserManagement | ACL definitions]]. In particular it is possible to limit access as illustrated in the following example.

<source>
deny|query|ASK
deny|query|UPDATE
allow|query|SELECT
allow|query|CONSTRUCT
</source>

The default configuration is as follows

* '''guests''': no queries allowed (=> deny|query|regexp(.*) )
* '''users''': all queries except UPDATE and ASK
* '''admins''': all queries allowed

The public SPARQL endpoint can be disabled with ''publicSparqlEndpointEnabled=false''. Also it should be noted that internal components can use a [[#Access control with security token| security token]] as part of the request to gain access.

==== Access Control with Security Token ====

In addition to the access control mechanisms described above, the {{PRODUCT}} provides support for access control with a security token. The security token is generated via SHA512 encoding from the query and from a key (which is to be set on the server side). Applications can define their own security key with the configuration property

<source>servletSecurityKey=MySecurityKey</source>

Note that default security keys are defined within both editions of the {{PRODUCT}}.

The security token comes handy when the public SPARQL endpoint is disabled: internal components (e.g. charts) can still access the SPARQL endpoint by providing a valid security token. Note that only SELECT and CONSTRUCT queries can be evaluated with such security token.

The security token can be passed as part of the request using the ''st'' parameter (e.g. ?query=&lt;q&gt;&st=&lt;t&gt;).

==== Access Control with Basic Authentication ====

The {{PRODUCT}} SPARQL endpoint supports ''Basic Authentication'' as a means for clients to provide credentials without explicitly using the Login interface. Clients that want to use the SPARQL endpoint with Basic Authentication need to provide the HTTP request parameter ''Authorization'' with the base64 encoded credentials. Some details are provided [http://en.wikipedia.org/wiki/Basic_access_authentication here].

==== Allowing Access for Unauthenticated Users ====

In certain use cases a public SPARQL endpoint (without permission checks) may be desired. To allow access to the SPARQL endpoint for unauthenticated users the following configuration adjustments needs to be done:

# Set the ''iwbAuthenticationScheme'' setting to ''noauth'' (Note: this can be done from [[Admin:Config]])
# Create an ACL extension by copying the following snippet to ''%IWB-HOME%/config/acl/extensions/role-publicSparqlEndpoint.acl'', then restart the system

<source>
### Extension role ###

@includedByRole: guest
@includeRole: sparql-query
</source>

This tells the system that each user with role ''guest'' (i.e., also unauthenticated users) have the permissions as defined by the ''sparql-query'' role (i.e., submitting SELECT and CONSTRUCT queries).

=== Supported Output Formats ===

The SPARQL endpoint supports both content negotiation via HTTP accept (as specified in the SPARQL protocol), and explicitly specifying the desired output format in the request. The latter can be done by setting '''format=&lt;MIME?TYPE&gt;''' in the request, using one of the following supported output formats. Note that the value ''auto'' can be used to achieve a suitable selection for each query type (i.e., also for SPARQL 1.1 UPDATE queries). 

'''GRAPH Queries (= Construct Queries)'''

* RDF/XML (application/rdf+xml)
* N-Triples (text/plain)
* Turtle (text/turtle)
* N3 (text/rdf+n3)
* TriX (application/trix)
* TriG (application/x-trig)
* N-Quads (text/x-nquads)

'''TUPLE Queries (= Select queries)'''

* SPARQL/XML (application/sparql-results+xml)
* SPARQL/JSON (application/sparql-results+json)
* SPARQL/CSV (text/csv)
* SPARQL/TSV (text/tab-separated-values)

=== Configuration ===

The SPARQL endpoint support the following configuration parameters as part of the request:

{| class="sortable wikitable" 
! Configuration
! Argument
|-
| query || A valid URL-encoded SPARQL 1.1 query (i.e., SELECT, CONSTRUCT, ASK or UPDATE), registered namespace prefixes are replaced
|-
| format || An optional argument to explicitly specify the output format (see [[#Supported output formats| here]] for a list of options)
|-
| infer || An optional boolean property to enable/disable inference, default: false. Requires repository support.
|-
| value || An optional argument that can be passed and is replaced for "??" in the SPARQL query
|}

=== Scripting via REST ===

The SPARQL endpoint can be used to retrieve data from clients via REST. Popular REST clients are wget or curl. The following example shows a wget command line which runs a query against the SPARQL endpoint:

<source>
wget --auth-no-challenge --http-user=admin --http-password=iwb --no-check-certificate 
"https://localhost:50443/sparql?query=select * where {?s ?p ?o}"
</source>

The arguments are as follows:

{| class="sortable wikitable" 
! Argument
! Description
|-
| --auth-no-challenge || makes sure the wget command sends the HTTP basic authentication header with the request
|-
| --http-user|| the user name which has query privileges
|-
| --http-password || the user's password
|-
| --no-check-certificate || makes sure wget accepts a self signed certificate
|-
|   || the query URL which in turn contains the query as a HTTP GET parameter. Note that other options such as repository etc. can be specified. See the instructions above for details
|}
